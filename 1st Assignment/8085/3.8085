BEGIN:
LDA 2000H		;Φόρτωσε στον Α την είσοδο
RRC			;Δεξιά ολίσθηση του Α και αποθήκευση του LSB στον CY
JNC BEGIN		;Αν CY = 0 άλμα στο BEGIN

MVI A,01H		;Αποθήκευση της θέσης του αναμμένου LED 
MVI H,01H		;Αποθήκευση της τελευταίας κατάστασης του LSB (ON) 


LSB2MSB:
CALL CHECK_MSB	;Κλήση της CHECK_MSB

GO_UP:
MVI E,00H		;Αποθήκευση της κατεύθυνσης 0: LSB->MSB
CALL CHECK_MSB	;Κλήση της CHECK_MSB
CALL CHECK_LSB	;Κλήση της CHECK_LSB
RLC			;Αριστερή ολίσθηση του Α και αποθήκευση του MSB στον CY

CPI 80H		;Σύγκριση του Α με το 80Η (1000 0000)
JZ MSB2LSB		;Αν ισούνται, άλμα στο MSB2LSB (αλλαγή κατεύθυνσης)
JMP GO_UP		;Αλλιώς άλμα στο GO_UP (συνεχίζει στην ίδια κατεύθυνση)


MSB2LSB:
CALL CHECK_MSB	;Κλήση της CHECK_MSB

GO_DOWN:
MVI E,01H		;Αποθήκευση της κατεύθυνσης 1: MSB->LSB
CALL CHECK_MSB	;Κλήση της CHECK_MSB
CALL CHECK_LSB	;Κλήση της CHECK_LSB
RRC			;Δεξιά ολίσθηση του Α και αποθήκευση του LSB στον CY

CPI 01H		;Σύγκριση του Α με το 01Η (0000 0001)
JZ LSB2MSB		;Αν ισούνται άλμα στο LSB2MSB (αλλαγή κατεύθυνσης)
JMP GO_DOWN		;Αλλιώς άλμα στο GO_DOWN(συνεχίζει στην ίδια κατεύθυνση)


CHECK_MSB:
	MOV D,A	;Αποθήκευση της τιμής του Α
	STALL:
	LDA 2000H	;Φόρτωση της εισόδου στον Α
	RLC		;Αριστερή ολίσθηση του Α και αποθήκευση του MSB στον CY
	JNC STALL	;Αν CY = 0, άλμα στο STALL
	MOV A,D	;Επαναφορά της τιμής του Α

	CMA		;Συμπλήρωμα ως προς 1 του Α και καταχώρηση του στον ίδιο
	STA 3000H	;Αποθήκευση της τιμής του Α στην έξοδο (άναμμα LED)
	LXI B,01F4H	;Φόρτωση στον BC της τιμής 500
	CALL DELB	;Καθυστέρηση BC*1ms
	CMA		;Συμπλήρωμα ως προς 1 του Α και καταχώρηση του στον ίδιο
RET


CHECK_LSB:
	MOV D,A	;Αποθήκευση της τιμής του Α
	LDA 2000H	;Φόρτωση της εισόδου στον Α
	RRC		;Δεξιά ολίσθηση και αποθήκευση του LSB στον CY
	JC LSB_ON	;Αν CY = 1, άλμα στο LSB_ON

	MOV A,H	;Αποθήκευση στον Α της τελευταίας τιμής του LSB
	CPI 00H	;Σύγκριση του Α με το 0
	JZ SKIP	;Αν ισούνται άλμα στο SKIP
	
	MVI H,00H	;Aλλιώς αποθήκευση της νέας τιμής του LSB (OFF -> αλλαγή κατεύθυνσης) 
	MOV A,D	;Επαναφορά της τιμής του Α
	CPI 80H	;Σύγκριση του Α με το 80Η (1000 0000)
	JZ SKIP	;Αν ισούνται άλμα στο SKIP
	CPI 01H	;Σύγκριση του Α με το 01Η (0000 0001)
	JZ SKIP	;Αν ισούνται άλμα στο SKIP
	MOV A,E	;Αλλιώς φόρτωση του Ε (κατεύθυνση) στον Α
	CPI 00H	;Σύγκριση του Α με το 00H 
	MOV A,D	;Επαναφορά του Α
	JZ GO_DOWN	;Αν η κατεύθυνση ήταν 0 τότε άλμα στο GO_DOWN
	JMP GO_UP	;Αλλιώς άλμα στο GO_UP

	LSB_ON:
	MVI H,01H	;Μετατροπή της τελευταίας κατάστασης του LED (ΟN)

	SKIP:
	MOV A,D	;Επαναφορά της τιμής του Α
RET


END
